---
import Layout from "../layouts/Layout.astro";
import InfoSection from "@/components/info-section";
import UserWelcome from "@/components/home/userWelcome"; // Import the hydrated component

// Interface for news items
interface NewsItem {
  student_news_id: number;
  title: string;
  news_category_name: string;
  news_contents: string;
  author_name: string;
  is_public: boolean;
  high_priority: boolean;
  publish_at: string;
  created_at: string;
  updated_at: string;
  read_at: string;
  is_read: boolean;
}

// Fetch student news for sneak peek (server-side)
const fetchStudentNewsDatas = async (): Promise<NewsItem[]> => {
  try {
    const response = await fetch("http://localhost:3000/student-news");
    if (!response.ok) throw new Error("Failed to fetch student news.");
    const data = await response.json();
    return data;
  } catch (error) {
    console.error("Error fetching student news:", error);
    return [];
  }
};

const item = await fetchStudentNewsDatas();

// Limit to 5 news items
const limitedNews = item.slice(0, 5);

// Grid button data
const buttons = [
  {
    title: "お知らせ",
    url: "/",
    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-inbox"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/></svg>`,
  },
  {
    title: "学校行事",
    url: "school_events",
    icon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>`,
  },
  // Add other buttons...
];
---

<Layout title="ホーム">
  <main
    class="mt-12 md:container mx-auto lg:mt-8 px-6 sm:px-16 xl:px-20 min-h-screen"
  >
    <!-- Welcome Section -->
    <UserWelcome client:only="react" /> <!-- Use the hydrated component here -->

    <!-- Buttons Section -->
    <div class="space-y-4">
      <!-- Absence Notification Button -->
      <div class="bg-white text-center p-4">
        <a
          href="/absent_forms"
          class="px-6 py-2 bg-gradient-to-r from-blue-400 to-blue-500 text-white font-bold rounded-full hover:from-blue-500 hover:to-blue-600 transition duration-200"
        >
          欠席・遅刻・公欠の連絡
        </a>
      </div>

      <!-- Student Survey Button -->
      <div class="bg-white text-center">
        <a
          href="https://enq.ecc-sv.com/student/"
          target="_blank"
          class="px-6 py-2 bg-gradient-to-r from-blue-400 to-blue-500 text-white font-bold rounded-full hover:from-blue-500 hover:to-blue-600 transition duration-200"
        >
          学生アンケートへ
        </a>
      </div>
    </div>

    <!-- Recent News Sneak Peek -->
    <section class="mt-8">
      <h2 class="text-lg font-bold mb-4">
        <a href="/">最近のニュース</a>
      </h2>
      <InfoSection client:load items={limitedNews} />
    </section>

    <!-- 3x3 Grid Buttons -->
    <section class="mt-8">
      <div
        class="grid grid-cols-2 sm:grid-cols-3 gap-4 p-4 bg-sky-100 rounded-md shadow-md"
      >
        {
          buttons.map((button) => (
            <a
              href={button.url}
              class="flex flex-col items-center justify-center gap-2 p-6 bg-sky-200 hover:bg-sky-300 rounded-md shadow-md transition duration-200"
            >
              <div class="w-10 h-10" innerHTML={button.icon} />
              <span class="text-lg font-bold text-sky-900 text-center">
                {button.title}
              </span>
            </a>
          ))
        }
      </div>
    </section>

    <!-- Image Section -->
    <div class="mt-8">
      <img
        src="/src/components/img/home.png"
        alt="Classroom"
   
